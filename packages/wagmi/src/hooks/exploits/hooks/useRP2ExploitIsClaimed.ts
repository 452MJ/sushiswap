'use client'

import { useBlockNumber, useReadContract } from 'wagmi'

import { useEffect } from 'react'
import { RP2ClaimChainId, isRP2ClaimChainId } from '../types'
import { ClaimContractConfig } from './useRP2ExploitClaim'

interface UseRP2ExploitIsClaimed {
  chainId: RP2ClaimChainId
  index: number
}
export const useRP2ExploitIsClaimed = ({
  index,
  chainId,
}: UseRP2ExploitIsClaimed) => {
  const query = useReadContract({
    ...ClaimContractConfig(chainId),
    functionName: 'isClaimed',
    args: [BigInt(index)],
    query: {
      enabled: isRP2ClaimChainId(chainId),
    },
  })

  const { data: blockNumber } = useBlockNumber({ watch: true })

  useEffect(() => {
    if (blockNumber) {
      query.refetch()
    }
  }, [blockNumber, query.refetch])

  return query
}
